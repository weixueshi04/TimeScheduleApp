# ğŸ“Š FocusLife æ ¸å¿ƒæ•°æ®æ¨¡å‹è®¾è®¡

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†FocusLife APPçš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼ŒåŒ…æ‹¬ä»»åŠ¡ã€ä¸“æ³¨è®°å½•ã€å¥åº·è®°å½•ç­‰ã€‚æ‰€æœ‰æ¨¡å‹éƒ½ä½¿ç”¨Hiveè¿›è¡Œæœ¬åœ°å­˜å‚¨ã€‚

---

## ğŸ¯ 1. ä»»åŠ¡æ¨¡å‹ï¼ˆTaskï¼‰

### æ•°æ®ç»“æ„

```dart
import 'package:hive/hive.dart';
import 'package:uuid/uuid.dart';

part 'task_model.g.dart'; // ä»£ç ç”Ÿæˆæ–‡ä»¶

@HiveType(typeId: 0)
class Task extends HiveObject {
  /// ä»»åŠ¡å”¯ä¸€ID
  @HiveField(0)
  final String id;

  /// ä»»åŠ¡æ ‡é¢˜
  @HiveField(1)
  String title;

  /// ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰
  @HiveField(2)
  String? description;

  /// ä»»åŠ¡åˆ†ç±»
  @HiveField(3)
  TaskCategory category;

  /// ä»»åŠ¡ä¼˜å…ˆçº§
  @HiveField(4)
  TaskPriority priority;

  /// æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰
  @HiveField(5)
  DateTime? dueDate;

  /// é¢„ä¼°å®Œæˆæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(6)
  int estimatedMinutes;

  /// å®é™…å®Œæˆæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(7)
  int actualMinutes;

  /// æ˜¯å¦å·²å®Œæˆ
  @HiveField(8)
  bool isCompleted;

  /// åˆ›å»ºæ—¶é—´
  @HiveField(9)
  DateTime createdAt;

  /// æ›´æ–°æ—¶é—´
  @HiveField(10)
  DateTime updatedAt;

  /// å­ä»»åŠ¡IDåˆ—è¡¨
  @HiveField(11)
  List<String> subTaskIds;

  /// æ˜¯å¦é‡å¤ä»»åŠ¡
  @HiveField(12)
  bool isRecurring;

  /// é‡å¤è§„åˆ™ï¼ˆå¯é€‰ï¼‰
  @HiveField(13)
  RecurringRule? recurringRule;

  /// ä»»åŠ¡æ ‡ç­¾
  @HiveField(14)
  List<String> tags;

  /// å®Œæˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰
  @HiveField(15)
  DateTime? completedAt;

  Task({
    String? id,
    required this.title,
    this.description,
    required this.category,
    required this.priority,
    this.dueDate,
    required this.estimatedMinutes,
    this.actualMinutes = 0,
    this.isCompleted = false,
    DateTime? createdAt,
    DateTime? updatedAt,
    List<String>? subTaskIds,
    this.isRecurring = false,
    this.recurringRule,
    List<String>? tags,
    this.completedAt,
  })  : id = id ?? const Uuid().v4(),
        createdAt = createdAt ?? DateTime.now(),
        updatedAt = updatedAt ?? DateTime.now(),
        subTaskIds = subTaskIds ?? [],
        tags = tags ?? [];

  /// æ ‡è®°ä¸ºå®Œæˆ
  void markAsCompleted() {
    isCompleted = true;
    completedAt = DateTime.now();
    updatedAt = DateTime.now();
  }

  /// æ ‡è®°ä¸ºæœªå®Œæˆ
  void markAsIncomplete() {
    isCompleted = false;
    completedAt = null;
    updatedAt = DateTime.now();
  }

  /// æ›´æ–°å®é™…ç”¨æ—¶
  void updateActualTime(int minutes) {
    actualMinutes += minutes;
    updatedAt = DateTime.now();
  }

  /// æ˜¯å¦è¶…æ—¶
  bool get isOverdue {
    if (dueDate == null || isCompleted) return false;
    return DateTime.now().isAfter(dueDate!);
  }

  /// æ—¶é—´åå·®ï¼ˆå®é™…-é¢„ä¼°ï¼‰
  int get timeDeviation => actualMinutes - estimatedMinutes;

  /// æ—¶é—´æ•ˆç‡ï¼ˆé¢„ä¼°/å®é™…ï¼Œç™¾åˆ†æ¯”ï¼‰
  double get timeEfficiency {
    if (actualMinutes == 0) return 100.0;
    return (estimatedMinutes / actualMinutes) * 100;
  }

  /// å¤åˆ¶ä»»åŠ¡
  Task copyWith({
    String? title,
    String? description,
    TaskCategory? category,
    TaskPriority? priority,
    DateTime? dueDate,
    int? estimatedMinutes,
    int? actualMinutes,
    bool? isCompleted,
    List<String>? subTaskIds,
    bool? isRecurring,
    RecurringRule? recurringRule,
    List<String>? tags,
  }) {
    return Task(
      id: id,
      title: title ?? this.title,
      description: description ?? this.description,
      category: category ?? this.category,
      priority: priority ?? this.priority,
      dueDate: dueDate ?? this.dueDate,
      estimatedMinutes: estimatedMinutes ?? this.estimatedMinutes,
      actualMinutes: actualMinutes ?? this.actualMinutes,
      isCompleted: isCompleted ?? this.isCompleted,
      createdAt: createdAt,
      updatedAt: DateTime.now(),
      subTaskIds: subTaskIds ?? this.subTaskIds,
      isRecurring: isRecurring ?? this.isRecurring,
      recurringRule: recurringRule ?? this.recurringRule,
      tags: tags ?? this.tags,
      completedAt: completedAt,
    );
  }
}
```

---

### ä»»åŠ¡åˆ†ç±»æšä¸¾

```dart
@HiveType(typeId: 1)
enum TaskCategory {
  @HiveField(0)
  work,     // å·¥ä½œ

  @HiveField(1)
  study,    // å­¦ä¹ 

  @HiveField(2)
  life,     // ç”Ÿæ´»

  @HiveField(3)
  health,   // å¥åº·
}

extension TaskCategoryExtension on TaskCategory {
  String get displayName {
    switch (this) {
      case TaskCategory.work:
        return 'å·¥ä½œ';
      case TaskCategory.study:
        return 'å­¦ä¹ ';
      case TaskCategory.life:
        return 'ç”Ÿæ´»';
      case TaskCategory.health:
        return 'å¥åº·';
    }
  }

  Color get color {
    switch (this) {
      case TaskCategory.work:
        return CupertinoColors.systemBlue;
      case TaskCategory.study:
        return CupertinoColors.systemPurple;
      case TaskCategory.life:
        return CupertinoColors.systemOrange;
      case TaskCategory.health:
        return CupertinoColors.systemGreen;
    }
  }

  IconData get icon {
    switch (this) {
      case TaskCategory.work:
        return CupertinoIcons.briefcase;
      case TaskCategory.study:
        return CupertinoIcons.book;
      case TaskCategory.life:
        return CupertinoIcons.home;
      case TaskCategory.health:
        return CupertinoIcons.heart_fill;
    }
  }
}
```

---

### ä»»åŠ¡ä¼˜å…ˆçº§æšä¸¾

```dart
@HiveType(typeId: 2)
enum TaskPriority {
  @HiveField(0)
  low,      // ä½ä¼˜å…ˆçº§

  @HiveField(1)
  medium,   // ä¸­ä¼˜å…ˆçº§

  @HiveField(2)
  high,     // é«˜ä¼˜å…ˆçº§

  @HiveField(3)
  urgent,   // ç´§æ€¥
}

extension TaskPriorityExtension on TaskPriority {
  String get displayName {
    switch (this) {
      case TaskPriority.low:
        return 'ä½';
      case TaskPriority.medium:
        return 'ä¸­';
      case TaskPriority.high:
        return 'é«˜';
      case TaskPriority.urgent:
        return 'ç´§æ€¥';
    }
  }

  Color get color {
    switch (this) {
      case TaskPriority.low:
        return CupertinoColors.systemGrey;
      case TaskPriority.medium:
        return CupertinoColors.systemYellow;
      case TaskPriority.high:
        return CupertinoColors.systemOrange;
      case TaskPriority.urgent:
        return CupertinoColors.systemRed;
    }
  }

  int get sortOrder {
    switch (this) {
      case TaskPriority.urgent:
        return 0;
      case TaskPriority.high:
        return 1;
      case TaskPriority.medium:
        return 2;
      case TaskPriority.low:
        return 3;
    }
  }
}
```

---

### å­ä»»åŠ¡æ¨¡å‹

```dart
@HiveType(typeId: 3)
class SubTask extends HiveObject {
  @HiveField(0)
  final String id;

  @HiveField(1)
  String title;

  @HiveField(2)
  bool isCompleted;

  @HiveField(3)
  DateTime createdAt;

  SubTask({
    String? id,
    required this.title,
    this.isCompleted = false,
    DateTime? createdAt,
  })  : id = id ?? const Uuid().v4(),
        createdAt = createdAt ?? DateTime.now();

  void toggle() {
    isCompleted = !isCompleted;
  }
}
```

---

### é‡å¤è§„åˆ™æ¨¡å‹

```dart
@HiveType(typeId: 4)
class RecurringRule extends HiveObject {
  /// é‡å¤ç±»å‹
  @HiveField(0)
  RecurringType type;

  /// é‡å¤é—´éš”ï¼ˆå¤©æ•°ï¼‰
  @HiveField(1)
  int interval;

  /// é‡å¤ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
  @HiveField(2)
  DateTime? endDate;

  /// æ¯å‘¨çš„å“ªå‡ å¤©ï¼ˆä»…å‘¨é‡å¤æ—¶ä½¿ç”¨ï¼‰
  @HiveField(3)
  List<int>? weekdays;

  RecurringRule({
    required this.type,
    this.interval = 1,
    this.endDate,
    this.weekdays,
  });
}

@HiveType(typeId: 5)
enum RecurringType {
  @HiveField(0)
  daily,    // æ¯å¤©

  @HiveField(1)
  weekly,   // æ¯å‘¨

  @HiveField(2)
  monthly,  // æ¯æœˆ

  @HiveField(3)
  custom,   // è‡ªå®šä¹‰
}
```

---

## â±ï¸ 2. ä¸“æ³¨ä¼šè¯æ¨¡å‹ï¼ˆFocusSessionï¼‰

```dart
@HiveType(typeId: 10)
class FocusSession extends HiveObject {
  /// ä¼šè¯ID
  @HiveField(0)
  final String id;

  /// å…³è”çš„ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
  @HiveField(1)
  String? taskId;

  /// å¼€å§‹æ—¶é—´
  @HiveField(2)
  DateTime startTime;

  /// ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼Œè¿›è¡Œä¸­æ—¶ä¸ºnullï¼‰
  @HiveField(3)
  DateTime? endTime;

  /// æŒç»­æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(4)
  int durationMinutes;

  /// è®¾å®šæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(5)
  int targetMinutes;

  /// ä¸­æ–­æ¬¡æ•°
  @HiveField(6)
  int interruptionCount;

  /// æ˜¯å¦å®Œæ•´å®Œæˆ
  @HiveField(7)
  bool isCompleted;

  /// ä¸“æ³¨ç±»å‹
  @HiveField(8)
  FocusType focusType;

  /// å¤‡æ³¨
  @HiveField(9)
  String? notes;

  /// ä½¿ç”¨çš„ç™½å™ªéŸ³
  @HiveField(10)
  String? soundType;

  FocusSession({
    String? id,
    this.taskId,
    required this.startTime,
    this.endTime,
    this.durationMinutes = 0,
    required this.targetMinutes,
    this.interruptionCount = 0,
    this.isCompleted = false,
    this.focusType = FocusType.pomodoro,
    this.notes,
    this.soundType,
  }) : id = id ?? const Uuid().v4();

  /// ç»“æŸä¼šè¯
  void complete() {
    endTime = DateTime.now();
    durationMinutes = endTime!.difference(startTime).inMinutes;
    isCompleted = durationMinutes >= targetMinutes;
  }

  /// è®°å½•ä¸­æ–­
  void interrupt() {
    interruptionCount++;
  }

  /// æ˜¯å¦æ­£åœ¨è¿›è¡Œ
  bool get isActive => endTime == null;

  /// å®Œæˆç‡
  double get completionRate {
    if (targetMinutes == 0) return 0;
    return (durationMinutes / targetMinutes).clamp(0.0, 1.0);
  }
}

@HiveType(typeId: 11)
enum FocusType {
  @HiveField(0)
  pomodoro,     // ç•ªèŒ„é’Ÿï¼ˆ25åˆ†é’Ÿï¼‰

  @HiveField(1)
  shortBreak,   // çŸ­ä¼‘æ¯ï¼ˆ5åˆ†é’Ÿï¼‰

  @HiveField(2)
  longBreak,    // é•¿ä¼‘æ¯ï¼ˆ15åˆ†é’Ÿï¼‰

  @HiveField(3)
  custom,       // è‡ªå®šä¹‰æ—¶é•¿
}
```

---

## ğŸƒ 3. å¥åº·è®°å½•æ¨¡å‹ï¼ˆHealthRecordï¼‰

```dart
@HiveType(typeId: 20)
class HealthRecord extends HiveObject {
  /// è®°å½•ID
  @HiveField(0)
  final String id;

  /// æ—¥æœŸï¼ˆä»…æ—¥æœŸï¼Œä¸å«æ—¶é—´ï¼‰
  @HiveField(1)
  DateTime date;

  /// ç¡çœ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(2)
  int sleepMinutes;

  /// å…¥ç¡æ—¶é—´
  @HiveField(3)
  DateTime? bedTime;

  /// èµ·åºŠæ—¶é—´
  @HiveField(4)
  DateTime? wakeTime;

  /// é¥®æ°´æ¬¡æ•°
  @HiveField(5)
  int waterCount;

  /// é¥®æ°´è®°å½•æ—¶é—´
  @HiveField(6)
  List<DateTime> waterTimes;

  /// ä¹…åæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(7)
  int sitMinutes;

  /// è¿åŠ¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(8)
  int exerciseMinutes;

  /// ç”¨é¤è®°å½•
  @HiveField(9)
  List<MealRecord> mealRecords;

  /// æ­¥æ•°
  @HiveField(10)
  int steps;

  /// å¤‡æ³¨
  @HiveField(11)
  String? notes;

  HealthRecord({
    String? id,
    required this.date,
    this.sleepMinutes = 0,
    this.bedTime,
    this.wakeTime,
    this.waterCount = 0,
    List<DateTime>? waterTimes,
    this.sitMinutes = 0,
    this.exerciseMinutes = 0,
    List<MealRecord>? mealRecords,
    this.steps = 0,
    this.notes,
  })  : id = id ?? const Uuid().v4(),
        waterTimes = waterTimes ?? [],
        mealRecords = mealRecords ?? [];

  /// æ·»åŠ é¥®æ°´è®°å½•
  void addWater() {
    waterCount++;
    waterTimes.add(DateTime.now());
  }

  /// æ·»åŠ ç”¨é¤è®°å½•
  void addMeal(MealType type) {
    mealRecords.add(MealRecord(
      type: type,
      time: DateTime.now(),
    ));
  }

  /// æ›´æ–°ç¡çœ æ—¶é•¿
  void updateSleep(DateTime bedTime, DateTime wakeTime) {
    this.bedTime = bedTime;
    this.wakeTime = wakeTime;
    sleepMinutes = wakeTime.difference(bedTime).inMinutes;
  }

  /// æ˜¯å¦è¾¾åˆ°ç¡çœ ç›®æ ‡ï¼ˆ8å°æ—¶ï¼‰
  bool get isSleepGoalMet => sleepMinutes >= 480;

  /// æ˜¯å¦è¾¾åˆ°é¥®æ°´ç›®æ ‡ï¼ˆ8æ¯ï¼‰
  bool get isWaterGoalMet => waterCount >= 8;

  /// æ˜¯å¦è¾¾åˆ°è¿åŠ¨ç›®æ ‡ï¼ˆ30åˆ†é’Ÿï¼‰
  bool get isExerciseGoalMet => exerciseMinutes >= 30;

  /// å¥åº·è¯„åˆ†ï¼ˆ0-100ï¼‰
  int get healthScore {
    int score = 0;
    
    // ç¡çœ å¾—åˆ†ï¼ˆ40åˆ†ï¼‰
    if (sleepMinutes >= 480) {
      score += 40;
    } else {
      score += (sleepMinutes / 480 * 40).round();
    }
    
    // é¥®æ°´å¾—åˆ†ï¼ˆ20åˆ†ï¼‰
    if (waterCount >= 8) {
      score += 20;
    } else {
      score += (waterCount / 8 * 20).round();
    }
    
    // è¿åŠ¨å¾—åˆ†ï¼ˆ30åˆ†ï¼‰
    if (exerciseMinutes >= 30) {
      score += 30;
    } else {
      score += (exerciseMinutes / 30 * 30).round();
    }
    
    // ç”¨é¤å¾—åˆ†ï¼ˆ10åˆ†ï¼‰
    if (mealRecords.length >= 3) {
      score += 10;
    } else {
      score += (mealRecords.length / 3 * 10).round();
    }
    
    return score;
  }
}
```

---

### ç”¨é¤è®°å½•æ¨¡å‹

```dart
@HiveType(typeId: 21)
class MealRecord extends HiveObject {
  @HiveField(0)
  MealType type;

  @HiveField(1)
  DateTime time;

  @HiveField(2)
  String? notes;

  MealRecord({
    required this.type,
    required this.time,
    this.notes,
  });
}

@HiveType(typeId: 22)
enum MealType {
  @HiveField(0)
  breakfast,  // æ—©é¤

  @HiveField(1)
  lunch,      // åˆé¤

  @HiveField(2)
  dinner,     // æ™šé¤

  @HiveField(3)
  snack,      // åŠ é¤
}

extension MealTypeExtension on MealType {
  String get displayName {
    switch (this) {
      case MealType.breakfast:
        return 'æ—©é¤';
      case MealType.lunch:
        return 'åˆé¤';
      case MealType.dinner:
        return 'æ™šé¤';
      case MealType.snack:
        return 'åŠ é¤';
    }
  }

  TimeOfDay get recommendedTime {
    switch (this) {
      case MealType.breakfast:
        return const TimeOfDay(hour: 7, minute: 0);
      case MealType.lunch:
        return const TimeOfDay(hour: 12, minute: 0);
      case MealType.dinner:
        return const TimeOfDay(hour: 18, minute: 0);
      case MealType.snack:
        return const TimeOfDay(hour: 15, minute: 0);
    }
  }
}
```

---

## ğŸ“ˆ 4. ç»Ÿè®¡æ•°æ®æ¨¡å‹ï¼ˆStatisticsï¼‰

```dart
@HiveType(typeId: 30)
class DailyStatistics extends HiveObject {
  @HiveField(0)
  final String id;

  @HiveField(1)
  DateTime date;

  /// ä»»åŠ¡ç»Ÿè®¡
  @HiveField(2)
  int totalTasks;

  @HiveField(3)
  int completedTasks;

  @HiveField(4)
  int overdueTasks;

  /// æ—¶é—´ç»Ÿè®¡ï¼ˆåˆ†é’Ÿï¼‰
  @HiveField(5)
  int focusMinutes;

  @HiveField(6)
  int plannedMinutes;

  @HiveField(7)
  int actualMinutes;

  /// æ•ˆç‡æŒ‡æ ‡
  @HiveField(8)
  double focusRate;         // ä¸“æ³¨ç‡

  @HiveField(9)
  double completionRate;    // å®Œæˆç‡

  @HiveField(10)
  double timeEfficiency;    // æ—¶é—´æ•ˆç‡

  /// å¥åº·æŒ‡æ ‡
  @HiveField(11)
  int healthScore;

  DailyStatistics({
    String? id,
    required this.date,
    this.totalTasks = 0,
    this.completedTasks = 0,
    this.overdueTasks = 0,
    this.focusMinutes = 0,
    this.plannedMinutes = 0,
    this.actualMinutes = 0,
    this.focusRate = 0.0,
    this.completionRate = 0.0,
    this.timeEfficiency = 0.0,
    this.healthScore = 0,
  }) : id = id ?? const Uuid().v4();

  /// è®¡ç®—ç»Ÿè®¡æ•°æ®
  void calculate(List<Task> tasks, List<FocusSession> sessions, HealthRecord? health) {
    // ä»»åŠ¡ç»Ÿè®¡
    totalTasks = tasks.length;
    completedTasks = tasks.where((t) => t.isCompleted).length;
    overdueTasks = tasks.where((t) => t.isOverdue).length;

    // æ—¶é—´ç»Ÿè®¡
    plannedMinutes = tasks.fold(0, (sum, task) => sum + task.estimatedMinutes);
    actualMinutes = tasks.fold(0, (sum, task) => sum + task.actualMinutes);
    focusMinutes = sessions.fold(0, (sum, session) => sum + session.durationMinutes);

    // æ•ˆç‡è®¡ç®—
    completionRate = totalTasks > 0 ? completedTasks / totalTasks : 0.0;
    focusRate = plannedMinutes > 0 ? focusMinutes / plannedMinutes : 0.0;
    timeEfficiency = actualMinutes > 0 ? plannedMinutes / actualMinutes : 0.0;

    // å¥åº·è¯„åˆ†
    healthScore = health?.healthScore ?? 0;
  }
}
```

---

## ğŸ”§ 5. ç”¨æˆ·è®¾ç½®æ¨¡å‹ï¼ˆUserSettingsï¼‰

```dart
@HiveType(typeId: 40)
class UserSettings extends HiveObject {
  /// ç•ªèŒ„é’Ÿè®¾ç½®
  @HiveField(0)
  int pomodoroMinutes;      // é»˜è®¤25åˆ†é’Ÿ

  @HiveField(1)
  int shortBreakMinutes;    // é»˜è®¤5åˆ†é’Ÿ

  @HiveField(2)
  int longBreakMinutes;     // é»˜è®¤15åˆ†é’Ÿ

  @HiveField(3)
  int pomodorosBeforeLongBreak;  // é»˜è®¤4ä¸ªç•ªèŒ„é’Ÿ

  /// æé†’è®¾ç½®
  @HiveField(4)
  bool enableTaskReminders;

  @HiveField(5)
  bool enableHealthReminders;

  /// ä¹…åæé†’
  @HiveField(6)
  bool enableSitReminder;

  @HiveField(7)
  int sitReminderMinutes;   // é»˜è®¤60åˆ†é’Ÿ

  /// é¥®æ°´æé†’
  @HiveField(8)
  bool enableWaterReminder;

  @HiveField(9)
  int waterReminderMinutes; // é»˜è®¤120åˆ†é’Ÿ

  /// ç¡çœ æé†’
  @HiveField(10)
  bool enableSleepReminder;

  @HiveField(11)
  TimeOfDay bedTime;        // é»˜è®¤22:00

  @HiveField(12)
  int sleepReminderMinutesBefore;  // æå‰30åˆ†é’Ÿ

  /// ç›®æ ‡è®¾ç½®
  @HiveField(13)
  int dailySleepGoalMinutes;  // é»˜è®¤480åˆ†é’Ÿï¼ˆ8å°æ—¶ï¼‰

  @HiveField(14)
  int dailyWaterGoal;         // é»˜è®¤8æ¯

  @HiveField(15)
  int dailyExerciseGoalMinutes;  // é»˜è®¤30åˆ†é’Ÿ

  /// ç•Œé¢è®¾ç½®
  @HiveField(16)
  bool isDarkMode;

  @HiveField(17)
  String language;  // 'zh_CN', 'en_US'

  UserSettings({
    this.pomodoroMinutes = 25,
    this.shortBreakMinutes = 5,
    this.longBreakMinutes = 15,
    this.pomodorosBeforeLongBreak = 4,
    this.enableTaskReminders = true,
    this.enableHealthReminders = true,
    this.enableSitReminder = true,
    this.sitReminderMinutes = 60,
    this.enableWaterReminder = true,
    this.waterReminderMinutes = 120,
    this.enableSleepReminder = true,
    TimeOfDay? bedTime,
    this.sleepReminderMinutesBefore = 30,
    this.dailySleepGoalMinutes = 480,
    this.dailyWaterGoal = 8,
    this.dailyExerciseGoalMinutes = 30,
    this.isDarkMode = false,
    this.language = 'zh_CN',
  }) : bedTime = bedTime ?? const TimeOfDay(hour: 22, minute: 0);
}
```

---

## ğŸ“¦ 6. æ•°æ®åˆå§‹åŒ–ä¸ç®¡ç†

### Hiveåˆå§‹åŒ–ä»£ç 

```dart
// lib/data/local/hive_service.dart

import 'package:hive_flutter/hive_flutter.dart';
import 'package:focus_life/data/models/task_model.dart';
import 'package:focus_life/data/models/focus_session_model.dart';
import 'package:focus_life/data/models/health_record_model.dart';
import 'package:focus_life/data/models/user_settings_model.dart';

class HiveService {
  static const String tasksBox = 'tasks';
  static const String focusSessionsBox = 'focus_sessions';
  static const String healthRecordsBox = 'health_records';
  static const String settingsBox = 'settings';

  /// åˆå§‹åŒ–Hive
  static Future<void> init() async {
    await Hive.initFlutter();

    // æ³¨å†ŒAdapter
    Hive.registerAdapter(TaskAdapter());
    Hive.registerAdapter(TaskCategoryAdapter());
    Hive.registerAdapter(TaskPriorityAdapter());
    Hive.registerAdapter(SubTaskAdapter());
    Hive.registerAdapter(RecurringRuleAdapter());
    Hive.registerAdapter(RecurringTypeAdapter());
    
    Hive.registerAdapter(FocusSessionAdapter());
    Hive.registerAdapter(FocusTypeAdapter());
    
    Hive.registerAdapter(HealthRecordAdapter());
    Hive.registerAdapter(MealRecordAdapter());
    Hive.registerAdapter(MealTypeAdapter());
    
    Hive.registerAdapter(UserSettingsAdapter());

    // æ‰“å¼€Box
    await Hive.openBox<Task>(tasksBox);
    await Hive.openBox<FocusSession>(focusSessionsBox);
    await Hive.openBox<HealthRecord>(healthRecordsBox);
    await Hive.openBox<UserSettings>(settingsBox);
  }

  /// è·å–Tasks Box
  static Box<Task> get tasksBox => Hive.box<Task>(HiveService.tasksBox);

  /// è·å–FocusSessions Box
  static Box<FocusSession> get focusSessionsBox => 
      Hive.box<FocusSession>(HiveService.focusSessionsBox);

  /// è·å–HealthRecords Box
  static Box<HealthRecord> get healthRecordsBox => 
      Hive.box<HealthRecord>(HiveService.healthRecordsBox);

  /// è·å–Settings Box
  static Box<UserSettings> get settingsBox => 
      Hive.box<UserSettings>(HiveService.settingsBox);

  /// å…³é—­æ‰€æœ‰Box
  static Future<void> close() async {
    await Hive.close();
  }
}
```

---

### åœ¨main.dartä¸­åˆå§‹åŒ–

```dart
// lib/main.dart

import 'package:flutter/cupertino.dart';
import 'package:focus_life/data/local/hive_service.dart';
import 'package:focus_life/core/themes/app_theme.dart';
import 'package:focus_life/presentation/navigation/main_tab_navigator.dart';

void main() async {
  // ç¡®ä¿Flutterç»‘å®šåˆå§‹åŒ–
  WidgetsFlutterBinding.ensureInitialized();

  // åˆå§‹åŒ–Hiveæ•°æ®åº“
  await HiveService.init();

  runApp(const FocusLifeApp());
}

class FocusLifeApp extends StatelessWidget {
  const FocusLifeApp({super.key});

  @override
  Widget build(BuildContext context) {
    return CupertinoApp(
      title: 'FocusLife',
      theme: AppTheme.lightTheme,
      home: const MainTabNavigator(),
      debugShowCheckedModeBanner: false,
    );
  }
}
```

---

## ğŸ”¨ ä»£ç ç”Ÿæˆå‘½ä»¤

åœ¨å®šä¹‰å®Œæ•°æ®æ¨¡å‹åï¼Œéœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”ŸæˆAdapterä»£ç ï¼š

```bash
# ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰Adapter
flutter packages pub run build_runner build

# æˆ–è€…ä½¿ç”¨watchæ¨¡å¼ï¼ˆè‡ªåŠ¨æ£€æµ‹å˜åŒ–ï¼‰
flutter packages pub run build_runner watch

# åˆ é™¤æ—§æ–‡ä»¶é‡æ–°ç”Ÿæˆ
flutter packages pub run build_runner build --delete-conflicting-outputs
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºä»»åŠ¡

```dart
// åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡
final task = Task(
  title: 'å®Œæˆé¡¹ç›®æŠ¥å‘Š',
  description: 'æ•´ç†æ•°æ®å¹¶æ’°å†™åˆ†ææŠ¥å‘Š',
  category: TaskCategory.work,
  priority: TaskPriority.high,
  dueDate: DateTime.now().add(const Duration(days: 3)),
  estimatedMinutes: 120,
);

// ä¿å­˜åˆ°æ•°æ®åº“
final box = HiveService.tasksBox;
await box.put(task.id, task);
```

### æŸ¥è¯¢ä»»åŠ¡

```dart
// è·å–æ‰€æœ‰ä»»åŠ¡
final allTasks = HiveService.tasksBox.values.toList();

// è·å–ä»Šå¤©çš„ä»»åŠ¡
final today = DateTime.now();
final todayTasks = allTasks.where((task) {
  return task.dueDate != null &&
         task.dueDate!.year == today.year &&
         task.dueDate!.month == today.month &&
         task.dueDate!.day == today.day;
}).toList();

// è·å–æœªå®Œæˆçš„é«˜ä¼˜å…ˆçº§ä»»åŠ¡
final urgentTasks = allTasks.where((task) {
  return !task.isCompleted && 
         (task.priority == TaskPriority.urgent || 
          task.priority == TaskPriority.high);
}).toList();
```

### æ›´æ–°ä»»åŠ¡

```dart
// æ ‡è®°ä»»åŠ¡å®Œæˆ
task.markAsCompleted();
await task.save();

// æ›´æ–°ä»»åŠ¡ä¿¡æ¯
final updatedTask = task.copyWith(
  title: 'æ–°æ ‡é¢˜',
  estimatedMinutes: 90,
);
await HiveService.tasksBox.put(updatedTask.id, updatedTask);
```

### åˆ é™¤ä»»åŠ¡

```dart
// åˆ é™¤å•ä¸ªä»»åŠ¡
await task.delete();

// æˆ–ä½¿ç”¨Boxåˆ é™¤
await HiveService.tasksBox.delete(task.id);
```

---

## âœ… æ•°æ®æ¨¡å‹æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ‰€æœ‰é¡¹ï¼Œæ•°æ®æ¨¡å‹å°±è®¾è®¡å®Œæˆäº†ï¼š

- [ ] Taskæ¨¡å‹å®šä¹‰å®Œæˆ
- [ ] FocusSessionæ¨¡å‹å®šä¹‰å®Œæˆ
- [ ] HealthRecordæ¨¡å‹å®šä¹‰å®Œæˆ
- [ ] UserSettingsæ¨¡å‹å®šä¹‰å®Œæˆ
- [ ] æ‰€æœ‰æšä¸¾ç±»å‹å®šä¹‰å®Œæˆ
- [ ] Extensionæ‰©å±•å®šä¹‰å®Œæˆ
- [ ] HiveServiceå·¥å…·ç±»åˆ›å»ºå®Œæˆ
- [ ] ç”ŸæˆAdapterä»£ç ï¼ˆbuild_runnerï¼‰
- [ ] åœ¨main.dartä¸­åˆå§‹åŒ–Hive
- [ ] æµ‹è¯•æ•°æ®çš„å¢åˆ æ”¹æŸ¥

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æœ‰äº†è¿™äº›æ•°æ®æ¨¡å‹ï¼Œä½ å°±å¯ä»¥ï¼š

1. åœ¨Providerä¸­ä½¿ç”¨è¿™äº›æ¨¡å‹ç®¡ç†çŠ¶æ€
2. åœ¨UIä¸­å±•ç¤ºå’Œæ“ä½œæ•°æ®
3. å®ç°æ•°æ®æŒä¹…åŒ–
4. è¿›è¡Œæ•°æ®ç»Ÿè®¡å’Œåˆ†æ

**è®°ä½ï¼šå¥½çš„æ•°æ®æ¨¡å‹æ˜¯æˆåŠŸçš„ä¸€åŠï¼**
